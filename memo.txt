ğŸ“‹ ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ã„æ–¹
VS Codeã‚„ã‚¨ãƒ‡ã‚£ã‚¿ã§æ–°ã—ããƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

ãƒ•ã‚¡ã‚¤ãƒ«åï¼šdocker_run.sh

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ï¼†ä¿å­˜

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•

å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸

bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
chmod +x docker_run.sh
ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œï¼

bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
./docker_run.sh

# ğŸš€ 1. ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ãƒ»åœæ­¢ãƒ»å†èµ·å‹•

# ğŸ“¦ ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•
docker compose up -d

# âŒ ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ãƒ»å‰Šé™¤ï¼ˆãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯æ®‹ã‚‹ï¼‰
docker compose down

# ğŸ” Dockerfileã‚’å¤‰æ›´ã—ãŸå ´åˆã®å†ãƒ“ãƒ«ãƒ‰ï¼†èµ·å‹•
docker compose up --build -d


# ğŸ” 2. ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼‰

# ğŸ Pythonç”¨ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹
docker exec -it python_container bash

# ğŸ˜ PostgreSQLç”¨ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚Šã€DBã«ç›´æ¥æ¥ç¶š
docker exec -it postgres_container psql -U myuser -d mydb


# ğŸ—ƒ 3. PostgreSQLã¸CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆCLIã‹ã‚‰ï¼‰

# ğŸ§¾ csvãƒ•ã‚¡ã‚¤ãƒ«ã‚’DBã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼ˆäº‹å‰ã«ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã—ã¦ãŠãï¼‰
\copy supermarket_sales FROM '/import_data/Kaggle_SuperMarket_Analysis.csv' DELIMITER ',' CSV HEADER;


# ğŸ›  4. Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œï¼ˆCLIæ–¹å¼ï¼‰

# ğŸ§® é€šå¸¸ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆä¾‹ï¼šsales_pipeline.pyï¼‰
docker exec -it python_container bash -c "PYTHONPATH=/app python scripts/sales_pipeline.py"

# ğŸ§­ CLIãƒ¡ãƒ‹ãƒ¥ãƒ¼å¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä¾‹ï¼šcli.py pipelineï¼‰
docker exec -it python_container bash -c "PYTHONPATH=/app python cli.py pipeline"


# ğŸ§¹ 5. ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒˆãƒ©ãƒ–ãƒ«æ™‚ï¼‰

# ğŸ§¼ åå‰è¡çªã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã¨ããªã©ã€å€‹åˆ¥ã«ã‚³ãƒ³ãƒ†ãƒŠå¼·åˆ¶å‰Šé™¤
docker rm -f postgres_container
docker rm -f python_container
docker rm -f pgadmin_container


# ğŸ“Š 6. ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®çŠ¶æ…‹ç¢ºèª

# â–¶ï¸ ç¨¼åƒä¸­ã‚³ãƒ³ãƒ†ãƒŠã®ã¿ç¢ºèª
docker ps

# â¹ åœæ­¢ä¸­ã‚‚å«ã‚ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠç¢ºèª
docker ps -a

# === 1. åˆæœŸåŒ– ===
echo "ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ"
mkdir -p app/import_data app/scripts app/query app/config app/output

# === 2. Dockerã‚µãƒ¼ãƒ“ã‚¹èµ·å‹• ===
echo "ğŸš€ Dockerèµ·å‹•"
docker compose up -d --build

# === 3. PostgreSQLã«æ¥ç¶šï¼ˆpsqlï¼‰===
echo "ğŸ˜ PostgreSQLæ¥ç¶š:"
echo "ã‚³ãƒãƒ³ãƒ‰: docker exec -it postgres_container psql -U myuser -d mydb"

# === 4. Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œä¾‹ ===
echo "ğŸ§® Pythonãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ"
docker exec -it python_container bash -c "PYTHONPATH=/app python scripts/sales_pipeline.py"

# === 5. CLIã‚³ãƒãƒ³ãƒ‰ä¾‹ ===
echo "ğŸ“Œ CLIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ"
docker exec -it python_container bash -c "PYTHONPATH=/app python cli.py pipeline"
"""

